# è§†é¢‘å‰ªè¾‘åŠŸèƒ½è¯´æ˜ / Video Clipping Feature Guide

## ä¸­æ–‡è¯´æ˜

### åŠŸèƒ½æ¦‚è¿°
TeslaCam Player ç°åœ¨æ”¯æŒè§†é¢‘å‰ªè¾‘åŠŸèƒ½!æ‚¨å¯ä»¥:
- âœ‚ï¸ åœ¨è¿›åº¦æ¡ä¸Šé€‰æ‹©èµ·å§‹å’Œç»“æŸä½ç½®
- ğŸ“¹ é€‰æ‹©è¦å¯¼å‡ºçš„æ‘„åƒå¤´(å‰/å/å·¦/å³)
- ğŸ• å¯¼å‡ºçš„è§†é¢‘åŒ…å«åŸå§‹æ—¶é—´ä¿¡æ¯
- ğŸ”— è‡ªåŠ¨å¤„ç†è·¨å¤šä¸ªæ–‡ä»¶çš„ç‰‡æ®µ

### ä½¿ç”¨æ­¥éª¤

#### 1. è¿›å…¥å‰ªè¾‘æ¨¡å¼
æ’­æ”¾è§†é¢‘å,ç‚¹å‡»æ’­æ”¾æ§åˆ¶æ å³ä¾§çš„ **âœ‚ï¸ å‰ªåˆ€å›¾æ ‡**,è¿›å…¥å‰ªè¾‘æ¨¡å¼ã€‚

#### 2. é€‰æ‹©æ—¶é—´èŒƒå›´
è¿›å…¥å‰ªè¾‘æ¨¡å¼å,è¿›åº¦æ¡ä¸Šä¼šå‡ºç°ä¸¤ä¸ª**è“è‰²æ‰‹æŸ„**:
- **å·¦ä¾§æ‰‹æŸ„**: å‰ªè¾‘èµ·å§‹ä½ç½®
- **å³ä¾§æ‰‹æŸ„**: å‰ªè¾‘ç»“æŸä½ç½®

æ‹–åŠ¨è¿™ä¸¤ä¸ªæ‰‹æŸ„åˆ°æ‚¨æƒ³è¦çš„ä½ç½®ã€‚é€‰ä¸­çš„åŒºåŸŸä¼šä»¥**è“è‰²åŠé€æ˜**æ˜¾ç¤ºã€‚

#### 3. æ‰“å¼€å¯¼å‡ºå¯¹è¯æ¡†
é€‰å¥½æ—¶é—´èŒƒå›´å,å†æ¬¡ç‚¹å‡» **âœ‚ï¸ å‰ªåˆ€å›¾æ ‡**,æ‰“å¼€å¯¼å‡ºè®¾ç½®å¯¹è¯æ¡†ã€‚

#### 4. é…ç½®å¯¼å‡ºé€‰é¡¹
åœ¨å¯¹è¯æ¡†ä¸­,æ‚¨å¯ä»¥:
- **é€‰æ‹©æ‘„åƒå¤´**: å‹¾é€‰è¦å¯¼å‡ºçš„æ‘„åƒå¤´(å‰/å/å·¦/å³)
  - å¯ä»¥é€‰æ‹©å•ä¸ªæ‘„åƒå¤´
  - ä¹Ÿå¯ä»¥åŒæ—¶é€‰æ‹©å¤šä¸ªæ‘„åƒå¤´,ä¼šåˆ†åˆ«å¯¼å‡º
- **æ·»åŠ æ—¶é—´æ°´å°**: å‹¾é€‰ååœ¨è§†é¢‘ä¸Šå åŠ æ—¶é—´ä¿¡æ¯(å¼€å‘ä¸­)
- **åˆæˆå››å®«æ ¼**: å°†å¤šä¸ªæ‘„åƒå¤´åˆæˆä¸ºä¸€ä¸ªå››å®«æ ¼è§†é¢‘(å¼€å‘ä¸­)

#### 5. å¼€å§‹å¯¼å‡º
ç‚¹å‡» **"å¼€å§‹å¯¼å‡º"** æŒ‰é’®:
- ç³»ç»Ÿä¼šæ˜¾ç¤ºå¤„ç†è¿›åº¦
- å¤„ç†å®Œæˆåä¼šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶
- æ–‡ä»¶åæ ¼å¼: `TeslaCam_{æ‘„åƒå¤´}_{æ—¶é—´æˆ³}.mp4`

### å½“å‰åŠŸèƒ½çŠ¶æ€

âœ… **å·²å®ç°**:
- è¿›åº¦æ¡ä¸Šçš„æ—¶é—´èŒƒå›´é€‰æ‹©
- å¤šæ‘„åƒå¤´åŒæ—¶å¯¼å‡º
- è·¨æ–‡ä»¶ç‰‡æ®µè¯†åˆ«
- è‡ªåŠ¨è®¡ç®—æ—¶é—´æˆ³
- **è§†é¢‘æ—¶é—´æˆ³æ°´å°** - å®æ—¶æ˜¾ç¤ºè§†é¢‘æ‹æ‘„æ—¶é—´
- **å››å®«æ ¼è§†é¢‘åˆæˆ** - å°†å¤šä¸ªæ‘„åƒå¤´åˆæˆä¸ºä¸€ä¸ªè§†é¢‘

ğŸš§ **å¼€å‘ä¸­** (å°†åœ¨åç»­ç‰ˆæœ¬æ·»åŠ ):
- ç²¾ç¡®çš„ç§’çº§å‰ªè¾‘(ä½¿ç”¨ FFmpeg.wasm)
- å¤šç‰‡æ®µè‡ªåŠ¨æ‹¼æ¥
- è‡ªå®šä¹‰æ°´å°æ ·å¼å’Œä½ç½®

### æ³¨æ„äº‹é¡¹

1. **è§†é¢‘æ ¼å¼**: å¯¼å‡ºçš„è§†é¢‘æ ¼å¼ä¸º WebM (VP9 ç¼–ç ),å…¼å®¹å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨å’Œæ’­æ”¾å™¨
   - å¦‚æœéœ€è¦ MP4 æ ¼å¼,å¯ä»¥ä½¿ç”¨æ ¼å¼è½¬æ¢å·¥å…·

2. **æ—¶é—´æˆ³åŠŸèƒ½**: 
   - å‹¾é€‰"æ·»åŠ æ—¶é—´æ°´å°"å,è§†é¢‘å·¦ä¸Šè§’ä¼šæ˜¾ç¤ºå®æ—¶æ—¶é—´
   - æ—¶é—´æ ¼å¼: YYYY-MM-DD HH:mm:ss
   - é»‘è‰²åŠé€æ˜èƒŒæ™¯,ç™½è‰²æ–‡å­—

3. **å››å®«æ ¼å¸ƒå±€**:
   - å‰æ‘„åƒå¤´: å·¦ä¸Š
   - åæ‘„åƒå¤´: å³ä¸Š  
   - å·¦æ‘„åƒå¤´: å·¦ä¸‹
   - å³æ‘„åƒå¤´: å³ä¸‹
   - æ¯ä¸ªç”»é¢å·¦ä¸Šè§’æ˜¾ç¤ºæ‘„åƒå¤´æ ‡ç­¾
   - æ•´ä½“æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨åº•éƒ¨ä¸­å¤®

4. **æ€§èƒ½å»ºè®®**: 
   - é€‰æ‹©è¾ƒçŸ­çš„æ—¶é—´èŒƒå›´å¯ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦
   - å››å®«æ ¼è§†é¢‘å¤„ç†æ—¶é—´ä¼šæ¯”å•æ‘„åƒå¤´é•¿
   - å»ºè®®å½•åˆ¶æ—¶é•¿ä¸è¶…è¿‡2åˆ†é’Ÿä»¥è·å¾—æœ€ä½³æ€§èƒ½

5. **æ–‡ä»¶å¤§å°**: 
   - å•æ‘„åƒå¤´: çº¦ 5 Mbps ç ç‡
   - å››å®«æ ¼: çº¦ 8 Mbps ç ç‡
   - å®é™…å¤§å°å–å†³äºé€‰ä¸­çš„æ—¶é—´é•¿åº¦

---

## English Guide

### Feature Overview
TeslaCam Player now supports video clipping! You can:
- âœ‚ï¸ Select start and end positions on the progress bar
- ğŸ“¹ Choose which cameras to export (front/back/left/right)
- ğŸ• Exported videos include original timestamp information
- ğŸ”— Automatically handles clips spanning multiple files

### How to Use

#### 1. Enter Clip Mode
While playing a video, click the **âœ‚ï¸ scissors icon** on the right side of the playback controls to enter clip mode.

#### 2. Select Time Range
After entering clip mode, two **blue handles** will appear on the progress bar:
- **Left handle**: Clip start position
- **Right handle**: Clip end position

Drag these handles to your desired positions. The selected range will be highlighted in **semi-transparent blue**.

#### 3. Open Export Dialog
After selecting your time range, click the **âœ‚ï¸ scissors icon** again to open the export settings dialog.

#### 4. Configure Export Options
In the dialog, you can:
- **Select Cameras**: Check the cameras you want to export (front/back/left/right)
  - You can select a single camera
  - Or select multiple cameras to export separately
- **Add Timestamp Watermark**: Overlay time information on the video (in development)
- **Merge as Grid**: Combine multiple cameras into a single grid video (in development)

#### 5. Start Export
Click the **"Start Export"** button:
- The system will show processing progress
- Files will automatically download when complete
- Filename format: `TeslaCam_{camera}_{timestamp}.mp4`

### Current Feature Status

âœ… **Implemented**:
- Time range selection on progress bar
- Multi-camera simultaneous export
- Cross-file segment recognition
- Automatic timestamp calculation
- **Video timestamp watermark** - Real-time display of recording time
- **Four-camera grid composition** - Merge multiple cameras into one video

ğŸš§ **In Development** (coming in future releases):
- Precise second-level trimming (using FFmpeg.wasm)
- Multi-segment automatic concatenation
- Custom watermark style and position

### Notes

1. **Video Format**: Exported videos are in WebM format (VP9 codec), compatible with most modern browsers and players
   - If you need MP4 format, use a format converter tool

2. **Timestamp Feature**: 
   - When "Add Timestamp Watermark" is checked, real-time timestamp appears in top-left corner
   - Time format: YYYY-MM-DD HH:mm:ss
   - Black semi-transparent background with white text

3. **Grid Layout**:
   - Front camera: Top-left
   - Back camera: Top-right
   - Left camera: Bottom-left
   - Right camera: Bottom-right
   - Each view shows camera label in top-left corner
   - Overall timestamp displayed at bottom center

4. **Performance Tips**: 
   - Selecting shorter time ranges speeds up processing
   - Grid video processing takes longer than single camera
   - Recommended duration: under 2 minutes for optimal performance

5. **File Size**: 
   - Single camera: ~5 Mbps bitrate
   - Grid video: ~8 Mbps bitrate
   - Actual size depends on selected duration

---

## æŠ€æœ¯å®ç° / Technical Implementation

### æ¶æ„ / Architecture
```
VideoClipProcessor (è§†é¢‘å¤„ç†å™¨)
â”œâ”€â”€ initCanvas() - åˆå§‹åŒ–Canvasç”»å¸ƒ
â”œâ”€â”€ getSegmentsForTimeRange() - è®¡ç®—éœ€è¦çš„ç‰‡æ®µ
â”œâ”€â”€ processClip() - å¤„ç†å‰ªè¾‘è¯·æ±‚
â”œâ”€â”€ processVideoWithTimestamp() - å•æ‘„åƒå¤´å¸¦æ—¶é—´æˆ³å¤„ç†
â”œâ”€â”€ createGridVideoFromSegments() - å››å®«æ ¼è§†é¢‘åˆæˆ
â””â”€â”€ drawTimestamp() - ç»˜åˆ¶æ—¶é—´æˆ³æ°´å°
```

### æŠ€æœ¯æ–¹æ¡ˆ / Technical Approach

**Canvas API + MediaRecorder**
- ä½¿ç”¨ Canvas ç»˜åˆ¶è§†é¢‘å¸§
- æ·»åŠ æ—¶é—´æˆ³æ–‡å­—å åŠ 
- MediaRecorder å®æ—¶å½•åˆ¶ Canvas æµ
- è¾“å‡º WebM æ ¼å¼è§†é¢‘

**å››å®«æ ¼åˆæˆ**
- åˆ›å»º 2x2 ç½‘æ ¼å¸ƒå±€
- åŒæ­¥æ’­æ”¾æ‰€æœ‰æ‘„åƒå¤´è§†é¢‘
- æ¯å¸§ç»˜åˆ¶åˆ°å¯¹åº”ç½‘æ ¼ä½ç½®
- æ·»åŠ æ‘„åƒå¤´æ ‡ç­¾å’Œç»Ÿä¸€æ—¶é—´æˆ³

### æœªæ¥æ”¹è¿› / Future Improvements
1. ~~é›†æˆ FFmpeg.wasm å®ç°ç²¾ç¡®å‰ªè¾‘~~ (ä½¿ç”¨ Canvas API æ›¿ä»£)
2. æ”¯æŒ MP4 æ ¼å¼å¯¼å‡º
3. è‡ªå®šä¹‰æ°´å°æ ·å¼ã€ä½ç½®ã€å¤§å°
4. æ·»åŠ è¿›åº¦æ¡æ ‡è®°æ˜¾ç¤ºå…³é”®äº‹ä»¶
5. æ”¯æŒæ‰¹é‡å¯¼å‡º
6. å¤šç‰‡æ®µè‡ªåŠ¨æ‹¼æ¥
